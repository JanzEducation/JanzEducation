<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><title>Admin JSON Upload | Janz Education</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body class="bg-slate-100 font-['Poppins'] p-5 hidden" id="admin-body">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-lg border-t-8 border-blue-900">
        <h1 class="text-2xl font-bold text-blue-900 mb-2">JSON Master Uploader ЁЯЪА</h1>
        <p class="text-sm text-gray-500 mb-6">рдпрд╣рд╛рдБ рдЕрдкрдирд╛ рдЯреЗрд╕реНрдЯ JSON рдкреЗрд╕реНрдЯ рдХрд░реЗрдВ, рд╕рд┐рд╕реНрдЯрдо рдЕрдкрдиреЗ рдЖрдк Exam, Subject рдФрд░ Chapter рдлреЛрд▓реНрдбрд░ рдмрдирд╛ рджреЗрдЧрд╛ред</p>
        
        <textarea id="json-input" rows="15" class="w-full p-4 border rounded-xl font-mono text-sm bg-gray-50 mb-4" placeholder='Paste your Test JSON here...'></textarea>
        
        <button onclick="uploadJSON()" class="w-full bg-blue-900 text-white py-4 rounded-xl font-bold hover:bg-yellow-500 hover:text-black transition">PUBLISH TEST AUTOMATICALLY</button>
    </div>

    <script type="module">
        import { auth, db } from "./config.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const ADMIN_EMAIL = "mdayubjanz@gmail.com"; 
        onAuthStateChanged(auth, (user) => {
            if (user && user.email === ADMIN_EMAIL) document.getElementById('admin-body').classList.remove('hidden');
            else window.location.href = "dashboard.html";
        });

        window.uploadJSON = async () => {
            try {
                const data = JSON.parse(document.getElementById('json-input').value);
                if(!data.exam || !data.questions) throw new Error("JSON missing exam or questions!");

                await addDoc(collection(db, "tests"), {
                    ...data,
                    totalQuestions: data.questions.length,
                    createdAt: serverTimestamp()
                });
                alert("тЬЕ Test Added to " + data.exam + " Folder!");
                document.getElementById('json-input').value = "";
            } catch (err) { alert("тЭМ Invalid JSON: " + err.message); }
        };
    </script>
</body>
</html>
