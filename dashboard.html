<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Janz Education</title>
    
    <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+Devanagari:wght@400;700&display=swap' rel='stylesheet'/>
    <script src='https://cdn.tailwindcss.com'></script>

    <style>
        /* üé® DESIGN - Premium Level */
        body { font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif; background: #f0f4f8; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden; }
        .main-wrapper { flex: 1; }

        /* üëá ‡§π‡•á‡§°‡§∞ ‡§î‡§∞ ‡§Æ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§¨‡§ü‡§® üëá */
        header { 
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); 
            color: #fff; padding: 12px 20px; 
            border-bottom: 4px solid #fbbf24; border-radius: 0 0 25px 25px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); 
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 50;
        }
        .menu-btn { background: none; border: none; color: white; font-size: 26px; cursor: pointer; padding: 0; }
        .header-text { text-align: center; flex: 1; }
        .header-text h1 { font-size: 18px; font-weight: 800; color: #fbbf24; margin: 0; letter-spacing: 1px; }
        .header-text p { font-size: 10px; opacity: 0.9; margin-top: 2px; color: #f8fafc; }
        .spacer { width: 26px; }

        /* üëá ‡§∏‡§æ‡§á‡§°‡§¨‡§æ‡§∞ (Drawer) ‡§°‡§ø‡•õ‡§æ‡§á‡§® üëá */
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 99; opacity: 0; visibility: hidden; transition: 0.3s ease; }
        .sidebar-overlay.active { opacity: 1; visibility: visible; }
        
        .sidebar { position: fixed; top: 0; left: -280px; width: 260px; height: 100vh; background: #ffffff; z-index: 100; box-shadow: 5px 0 15px rgba(0,0,0,0.2); transition: 0.3s ease; display: flex; flex-direction: column; }
        .sidebar.active { left: 0; }
        
        .sidebar-header { background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); padding: 30px 20px; color: white; text-align: center; border-bottom: 4px solid #fbbf24; }
        .sidebar-avatar { font-size: 40px; margin-bottom: 5px; background: rgba(255,255,255,0.2); width: 60px; height: 60px; border-radius: 50%; display: inline-flex; justify-content: center; align-items: center; border: 2px solid #fbbf24; }
        
        .sidebar-menu { list-style: none; padding: 10px 0; margin: 0; flex: 1; }
        .sidebar-menu li { padding: 15px 25px; display: flex; align-items: center; gap: 15px; color: #334155; font-weight: 600; font-size: 14px; border-bottom: 1px solid #f1f5f9; cursor: pointer; transition: 0.2s; }
        .sidebar-menu li:hover { background: #f8fafc; color: #2563eb; padding-left: 30px; }
        
        /* ‡§Æ‡•ã‡§ü‡§ø‡§µ‡•á‡§∂‡§®‡§≤ ‡§¨‡•â‡§ï‡•ç‡§∏ */
        .motivation-box { padding: 20px; background: #f8fafc; text-align: center; border-top: 1px solid #e2e8f0; }
        .motivation-text { font-size: 11px; font-style: italic; color: #64748b; margin-bottom: 8px; line-height: 1.6; font-weight: 600; }
        .motivation-author { font-size: 11px; font-weight: 800; color: #0f172a; letter-spacing: 0.5px; background: #fbbf24; padding: 3px 10px; border-radius: 12px; display: inline-block;}

        .main-container { max-width: 800px; margin: 20px auto; padding: 0 20px; }

        .welcome-box { background: white; padding: 20px; border-radius: 15px; border-left: 5px solid #2563eb; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        
        /* üìÅ VIP Folder Card Design (Medium Size: 140px) */
        .folder-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        .folder-card { 
            background: linear-gradient(145deg, #ffffff, #f8fafc); padding: 20px 10px; 
            border-radius: 18px; border: 1px solid #e2e8f0; text-align: center; cursor: pointer; 
            transition: all 0.3s ease; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.03), -4px -4px 10px rgba(255, 255, 255, 0.8);
        }
        .folder-card:hover { transform: translateY(-5px) scale(1.02); border-color: #fbbf24; background: linear-gradient(145deg, #fffbeb, #ffffff); box-shadow: 5px 10px 15px rgba(251, 191, 36, 0.15); }
        .folder-icon { font-size: 35px; margin-bottom: 8px; display: block; filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.1)); }

        /* üìù Test Card Style */
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .test-card { background: white; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .test-card:hover { transform: translateY(-3px); border-color: #2563eb; box-shadow: 0 8px 15px rgba(37, 99, 235, 0.1); }
        
        #loading-screen { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; justify-content: center; align-items: center; }
        
        footer { text-align: center; padding: 40px 20px; background: #fff; border-top: 2px solid #e2e8f0; margin-top: auto; }
        .about-box { background: #f8fafc; padding: 20px; border-radius: 15px; border: 1px dashed #cbd5e1; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900"></div>
    </div>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-avatar">üë®‚Äçüéì</div>
            <h3 id="sidebar-user-name" class="font-bold text-lg mt-2">Student</h3>
            <p class="text-[10px] text-blue-200 uppercase tracking-widest mt-1">Janz Education</p>
        </div>
        <ul class="sidebar-menu">
            <li onclick="window.location.href='dashboard.html'"><span class="text-xl">üè†</span> Home</li>
            <li><span class="text-xl">üë§</span> My Profile</li>
            <li id="sidebar-logout-btn" style="color: #ef4444;"><span class="text-xl">üö™</span> Logout</li>
        </ul>
        <div class="motivation-box">
            <p class="motivation-text">"‡§ï‡§†‡•ã‡§∞ ‡§™‡§∞‡§ø‡§∂‡•ç‡§∞‡§Æ ‡§ï‡§æ ‡§ï‡•ã‡§à ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§∏‡§´‡§≤‡§§‡§æ ‡§â‡§®‡•ç‡§π‡•Ä‡§Ç ‡§ï‡•ã ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§ï‡§≠‡•Ä ‡§π‡§æ‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§æ‡§®‡§§‡•á‡•§"</p>
            <p class="motivation-author">~ MD AYUB JANZ</p>
        </div>
    </div>

    <div class='main-wrapper'>
        <header>
            <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="header-text">
                <h1>JANZ EDUCATION</h1>
                <p>‡§∏‡§™‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§â‡•ú‡§æ‡§®, ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• üöÄ</p>
            </div>
            <div class="spacer"></div>
        </header>

        <div class='main-container'>
            
            <div class="welcome-box">
                <h2 class="text-xl font-bold text-gray-800">Hello, <span id="user-name">Student</span> üëã</h2>
                <div class="flex items-center gap-2 mt-2">
                    <button id="back-btn" class="hidden text-blue-600 font-bold text-xs bg-blue-50 px-3 py-1.5 rounded-lg shadow-sm hover:bg-blue-100 transition">‚¨ÖÔ∏è Back</button>
                    <p class="text-sm text-gray-500 font-medium" id="path-text">Test Series 2026</p>
                </div>
            </div>

            <h3 class="font-bold text-gray-700 mb-4 border-l-4 border-yellow-400 pl-3 uppercase tracking-wide text-sm" id="title-text">All Exams</h3>

            <div id="content-area" class="folder-grid">
                </div>

            <div id="no-data-msg" class="hidden text-center py-10 bg-white rounded-xl border border-dashed border-gray-300">
                <p class="text-gray-400 text-sm font-medium">‡§Ö‡§≠‡•Ä ‡§Ø‡§π‡§æ‡§Å ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>
            </div>

        </div>
    </div>

    <footer>
        <div class='about-box' style='max-width:560px; margin:0 auto;'>
            <h4 style='color:#0f172a; font-weight:bold; margin-bottom:10px;'>ABOUT US</h4>
            <p style='font-size:13px; color:#475569; line-height:1.6;'>‡§Ø‡§π ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡§æ‡§∞‡•ç‡§Æ <b>Janz Group</b> ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡§∞‡•ç‡§™‡§ø‡§§ ‡§π‡•à‡•§</p>
        </div>
        <p style='font-size: 12px; color: #64748b;'>¬©2026 Janz Education ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ By Janz Group</p>
    </footer>

    <script type="module">
        import { auth, db } from "./config.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        // OrderBy ‡§ú‡•ã‡•ú‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à ‡§§‡§æ‡§ï‡§ø ‡§ü‡•á‡§∏‡•ç‡§ü ‡§ï‡•ç‡§∞‡§Æ ‡§∏‡•á ‡§Ü‡§è‡§Å
        import { collection, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const loader = document.getElementById('loading-screen');
        const contentArea = document.getElementById('content-area');
        const pathText = document.getElementById('path-text');
        const titleText = document.getElementById('title-text');
        const backBtn = document.getElementById('back-btn');

        let allTests = [];
        let viewState = { level: 'exam', exam: '', subject: '' };
        let userResults = new Set();
        const ADMIN_EMAIL = "mdayubjanz@gmail.com";

        window.toggleSidebar = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebar-overlay').classList.toggle('active');
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                if(user.email === ADMIN_EMAIL) { window.location.href = "admin.html"; return; }
                document.getElementById('user-name').innerText = user.displayName || "Student";
                document.getElementById('sidebar-user-name').innerText = user.displayName || "Student";
                
                const resSnap = await getDocs(query(collection(db, "results"), where("userId", "==", user.uid)));
                resSnap.forEach(doc => userResults.add(doc.data().testId));

                // ‡§°‡•á‡§ü‡§æ‡§¨‡•á‡§∏ ‡§∏‡•á ‡§ü‡•á‡§∏‡•ç‡§ü ‡§ï‡•ç‡§∞‡§Æ (Order) ‡§Æ‡•á‡§Ç ‡§≤‡§æ‡§®‡•á ‡§ï‡§æ ‡§ï‡•ã‡§°
                const testQuery = query(collection(db, "tests"), orderBy("timestamp", "asc"));
                const testSnap = await getDocs(testQuery);
                allTests = testSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // ‡§∂‡•Å‡§∞‡•Å‡§Ü‡§§‡•Ä ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§ü ‡§ï‡§∞‡§®‡§æ
                history.replaceState({level: 'exam'}, "", "");
                renderUI();
                loader.style.display = 'none';
            } else {
                window.location.href = "index.html";
            }
        });

        function renderUI() {
            contentArea.innerHTML = "";
            document.getElementById('no-data-msg').classList.add('hidden');

            if (viewState.level === 'exam') {
                contentArea.className = "folder-grid";
                pathText.innerText = "Test Series 2026";
                titleText.innerText = "Select Exam Folder";
                backBtn.classList.add('hidden');

                const exams = [...new Set(allTests.map(t => t.exam))];
                if(exams.length === 0) document.getElementById('no-data-msg').classList.remove('hidden');
                exams.forEach(ex => createFolder(ex, "üéì", () => {
                    viewState.level = 'subject'; viewState.exam = ex; 
                    history.pushState({level: 'subject'}, "", "#subject"); // ‡§¨‡•à‡§ï ‡§¨‡§ü‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ
                    renderUI();
                }));
            } 
            else if (viewState.level === 'subject') {
                contentArea.className = "folder-grid";
                pathText.innerText = "2026 > " + viewState.exam;
                titleText.innerText = "Select Subject Folder";
                backBtn.classList.remove('hidden');

                const subjects = [...new Set(allTests.filter(t => t.exam === viewState.exam).map(t => t.subject))];
                subjects.forEach(sub => createFolder(sub, "üìò", () => {
                    viewState.level = 'test'; viewState.subject = sub; 
                    history.pushState({level: 'test'}, "", "#test"); // ‡§¨‡•à‡§ï ‡§¨‡§ü‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡•á‡§µ
                    renderUI();
                }));
            }
            else if (viewState.level === 'test') {
                contentArea.className = "test-grid";
                pathText.innerText = viewState.exam + " > " + viewState.subject;
                titleText.innerText = "Available Tests";
                backBtn.classList.remove('hidden');

                const tests = allTests.filter(t => t.exam === viewState.exam && t.subject === viewState.subject);
                tests.forEach(test => {
                    const isDone = userResults.has(test.id);
                    const isNotice = test.questions.length === 0; 
                    const card = `
                        <div class="test-card">
                            <div class="flex justify-between items-center mb-3">
                                <span class="bg-blue-100 text-blue-800 text-[10px] font-black tracking-wider px-3 py-1 rounded-full uppercase">
                                    ${isNotice ? 'üì¢ ‡§∏‡•Ç‡§ö‡§®‡§æ' : 'üìù ‡§ü‡•á‡§∏‡•ç‡§ü'}
                                </span>
                                <span class="text-[11px] font-bold text-gray-400 bg-gray-50 px-2 py-1 rounded-md">${isNotice ? '' : '‚è≥ ' + (test.duration || 0) + ' min'}</span>
                            </div>
                            <h4 class="font-bold text-base text-slate-800 leading-tight">${test.title}</h4>
                            
                            ${isNotice ? `
                                <p class="text-[12px] text-gray-500 mt-3 italic bg-yellow-50 p-2 rounded-lg border border-yellow-100">‡§™‡•ç‡§∞‡§ø‡§Ø ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç, ‡§Ø‡§π‡§æ‡§Å ‡§ú‡§≤‡•ç‡§¶ ‡§π‡•Ä ‡§ï‡§Ç‡§ü‡•á‡§Ç‡§ü ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã‡§ó‡§æ‡•§</p>
                            ` : `
                                <div class="text-[11px] font-semibold text-gray-500 mt-3 mb-4 bg-slate-50 p-2 rounded-lg flex justify-around">
                                    <span>üìù ${test.questions.length} Qs</span> <span class="text-gray-300">|</span> <span>üéØ ${test.questions.length} Marks</span>
                                </div>
                                <button onclick="startTest('${test.id}')" class="w-full ${isDone ? 'bg-slate-200 text-slate-600 hover:bg-slate-300' : 'bg-blue-700 text-white shadow-md shadow-blue-200 hover:bg-blue-800 hover:shadow-lg hover:-translate-y-1'} transition-all duration-300 py-3 rounded-xl font-bold text-sm tracking-wide">
                                    ${isDone ? 'üîÑ Re-attempt Test' : '‚ñ∂ Attempt Now'}
                                </button>
                            `}
                        </div>`;
                    contentArea.innerHTML += card;
                });
            }
        }

        function createFolder(name, icon, clickFn) {
            const div = document.createElement('div');
            div.className = "folder-card";
            div.innerHTML = `<span class="folder-icon">${icon}</span><span class="font-bold text-slate-700 text-sm block mt-2">${name}</span>`;
            div.onclick = clickFn;
            contentArea.appendChild(div);
        }

        // ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§µ‡§æ‡§≤‡§æ 'Back' ‡§¨‡§ü‡§®
        backBtn.onclick = () => {
            history.back(); // ‡§Ø‡§π ‡§®‡•Ä‡§ö‡•á ‡§µ‡§æ‡§≤‡•á onpopstate ‡§ï‡•ã ‡§ü‡•ç‡§∞‡§ø‡§ó‡§∞ ‡§ï‡§∞‡•á‡§ó‡§æ
        };

        // üëá ‡§´‡•ã‡§® ‡§ï‡§æ ‡§Ö‡§∏‡§≤‡•Ä (Hardware) 'Back' ‡§¨‡§ü‡§® ‡§ï‡§Ç‡§ü‡•ç‡§∞‡•ã‡§≤ ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§ï‡•ã‡§° üëá
        window.onpopstate = function(event) {
            if (viewState.level === 'test') { 
                viewState.level = 'subject'; 
                renderUI(); 
            }
            else if (viewState.level === 'subject') { 
                viewState.level = 'exam'; 
                renderUI(); 
            }
            else {
                // ‡§Ö‡§ó‡§∞ exam ‡§≤‡•á‡§µ‡§≤ ‡§™‡§∞ ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§ï‡•Å‡§õ ‡§® ‡§ï‡§∞‡•á‡§Ç, ‡§ê‡§™ ‡§¨‡•à‡§ï ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ
            }
        };

        window.startTest = (id) => {
            window.location.href = `test-player.html?id=${id}`;
        };

        document.getElementById('sidebar-logout-btn').onclick = () => signOut(auth);
    </script>
</body>
</html>
