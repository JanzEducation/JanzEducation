<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Janz Education</title>
    
    <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+Devanagari:wght@400;700&display=swap' rel='stylesheet'/>
    <script src='https://cdn.tailwindcss.com'></script>

    <style>
        /* üé® DESIGN - Apka pasandida layout */
        body { font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif; background: #f0f4f8; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; }
        .main-wrapper { flex: 1; }

        /* Header Style */
        header { 
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); 
            color: #fff; padding: 15px 5%; text-align: center; 
            border-bottom: 4px solid #fbbf24; border-radius: 0 0 25px 25px; 
            box-shadow: 0 5px 20px rgba(0,0,0,0.2); 
            position: relative;
        }
        header h1 { font-size: 24px; font-weight: 800; color: #fbbf24; margin: 0; }
        header p { font-size: 12px; opacity: 0.9; margin-top: 4px; color: #f8fafc; }

        .main-container { max-width: 800px; margin: 30px auto; padding: 0 20px; }

        /* Welcome Box */
        .welcome-box { background: white; padding: 20px; border-radius: 15px; border-left: 5px solid #2563eb; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        
        /* Test Card Style */
        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .test-card { 
            background: white; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; 
            transition: transform 0.2s; position: relative;
        }
        .test-card:hover { transform: translateY(-3px); border-color: #fbbf24; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        /* Buttons */
        .logout-btn { background: #fee2e2; color: #991b1b; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; cursor: pointer; border: none; float: right; transition: 0.2s;}
        .logout-btn:hover { background: #fecaca; }

        /* Loading Screen */
        #loading-screen { position: fixed; inset: 0; background: white; z-index: 100; display: flex; justify-content: center; align-items: center; }
        
        /* Footer Style */
        footer { text-align: center; padding: 40px 20px; background: #fff; border-top: 2px solid #e2e8f0; margin-top: auto; }
        .about-box { background: #f8fafc; padding: 20px; border-radius: 15px; border: 1px dashed #cbd5e1; margin-bottom: 20px; }
        .copy-text { font-size: 12px; color: #64748b; font-weight: 600; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-900"></div>
    </div>

    <div class='main-wrapper'>
        <header>
            <h1>JANZ EDUCATION</h1>
            <p>‡§∏‡§™‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§â‡•ú‡§æ‡§®, ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• üöÄ</p>
        </header>

        <div class='main-container'>
            
            <div class="welcome-box">
                <button id="logout-btn" class="logout-btn">Logout</button>
                <h2 class="text-xl font-bold text-gray-800">Hello, <span id="user-name">Student</span> üëã</h2>
                <p class="text-sm text-gray-500 mt-1">‡§Ü‡§™‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§ï‡•à‡§∏‡•Ä ‡§ö‡§≤ ‡§∞‡§π‡•Ä ‡§π‡•à?</p>
            </div>

            <h3 class="font-bold text-gray-700 mb-4 border-l-4 border-yellow-400 pl-3">Live Tests üî¥</h3>

            <div id="tests-container" class="test-grid">
                </div>

            <div id="no-tests-msg" class="hidden text-center py-10 bg-white rounded-xl border border-dashed border-gray-300">
                <p class="text-gray-400 text-sm">‡§Ö‡§≠‡•Ä ‡§ï‡•ã‡§à ‡§ü‡•á‡§∏‡•ç‡§ü ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>
                <p class="text-gray-400 text-xs mt-1">‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§ï‡•á ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§á‡§Ç‡§§‡•õ‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç‡•§</p>
            </div>

        </div>
    </div>

    <footer>
        <div class='about-box' style='max-width:560px; margin:0 auto;'>
            <h4 style='color:#0f172a; font-weight:bold; margin-bottom:10px;'>ABOUT US</h4>
            <p style='font-size:13px; color:#475569; line-height:1.6;'>‡§Ø‡§π ‡§™‡•ç‡§≤‡•á‡§ü‡§´‡§æ‡§∞‡•ç‡§Æ <b>Janz Group</b> ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•ã ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡•Ä ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡§∞‡•ç‡§™‡§ø‡§§ ‡§π‡•à‡•§</p>
            <a href='mailto:janztales@gmail.com' style='color:#1e40af; font-weight:700; text-decoration:none;'>üìß janztales@gmail.com</a>
        </div>
        <p class='copy-text'>¬©2026 Janz Education ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ By Janz Group</p>
    </footer>

    <script type="module">
        import { auth, db } from "./config.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const loader = document.getElementById('loading-screen');

        // 1. LOGIN CHECK
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User Login Hai
                console.log("User:", user.email);
                if(user.displayName) {
                    document.getElementById('user-name').innerText = user.displayName;
                }
                loadTests(); // Tests download karo
            } else {
                // User Login NAHI hai -> Wapas bhejo
                window.location.href = "index.html";
            }
        });

        // 2. LOAD TESTS FROM DATABASE
        async function loadTests() {
            const container = document.getElementById('tests-container');
            const noMsg = document.getElementById('no-tests-msg');
            container.innerHTML = ""; 

            try {
                // Database se 'tests' maango
                const q = query(collection(db, "tests"), orderBy("createdAt", "desc"));
                const snapshot = await getDocs(q);

                if (snapshot.empty) {
                    noMsg.classList.remove('hidden'); // Koi test nahi mila
                } else {
                    noMsg.classList.add('hidden');
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        const id = doc.id;
                        
                        // APKA DESIGN + REAL DATA
                        const card = `
                            <div class="test-card">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded uppercase">${data.subject}</span>
                                    <span class="text-xs text-gray-400">‚è±Ô∏è ${data.duration} Mins</span>
                                </div>
                                <h4 class="font-bold text-lg text-slate-800 leading-tight">${data.title}</h4>
                                <div class="text-xs text-gray-500 mt-2 mb-3">
                                    <span>üìù ${data.totalQuestions} Questions</span> ‚Ä¢ 
                                    <span>üéØ ${data.totalMarks} Marks</span>
                                </div>
                                <button onclick="startTest('${id}')" class="mt-2 w-full bg-blue-900 text-white py-2 rounded-lg font-bold text-sm hover:bg-yellow-500 hover:text-black transition">
                                    Start Test Now
                                </button>
                            </div>
                        `;
                        container.innerHTML += card;
                    });
                }
            } catch (err) {
                console.error("Error:", err);
            } finally {
                loader.style.display = 'none'; // Loader hatao
            }
        }

        // 3. START TEST (Abhi sirf alert dega)
        window.startTest = (testId) => {
            alert("Test ID: " + testId + "\n(Test Player hum agle step me banayenge!)");
            // window.location.href = `test-player.html?id=${testId}`;
        };

        // 4. LOGOUT
        document.getElementById('logout-btn').addEventListener('click', () => {
            if(confirm("Are you sure you want to logout?")) {
                signOut(auth).then(() => window.location.href = "index.html");
            }
        });
    </script>

</body>
</html>
