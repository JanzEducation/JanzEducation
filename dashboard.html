<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Janz Education</title>
    
    <link href='https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+Devanagari:wght@400;700&display=swap' rel='stylesheet'/>
    <script src='https://cdn.tailwindcss.com'></script>

    <style>
        body { font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif; background: #f0f4f8; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden; }
        .main-wrapper { flex: 1; padding-top: 80px; } /* Fixed header ke liye padding */

        header { 
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); 
            color: #fff; padding: 12px 20px; 
            border-bottom: 4px solid #fbbf24; border-radius: 0 0 20px 20px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
            display: flex; justify-content: space-between; align-items: center;
            position: fixed; top: 0; left: 0; right: 0; z-index: 100;
        }
        .menu-btn { background: none; border: none; color: white; font-size: 26px; cursor: pointer; padding: 0; }
        .header-text h1 { font-size: 18px; font-weight: 800; color: #fbbf24; margin: 0; text-align: center; }
        .header-text p { font-size: 10px; opacity: 0.9; text-align: center; }

        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 101; opacity: 0; visibility: hidden; transition: 0.3s; }
        .sidebar-overlay.active { opacity: 1; visibility: visible; }
        .sidebar { position: fixed; top: 0; left: -280px; width: 260px; height: 100vh; background: #fff; z-index: 102; transition: 0.3s; display: flex; flex-direction: column; }
        .sidebar.active { left: 0; }
        .sidebar-header { background: #0f172a; padding: 30px 20px; color: white; text-align: center; border-bottom: 4px solid #fbbf24; }
        .sidebar-menu li { padding: 15px 25px; border-bottom: 1px solid #f1f5f9; cursor: pointer; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        
        .motivation-box { padding: 15px; background: #f8fafc; text-align: center; border-top: 1px solid #e2e8f0; }
        .motivation-text { font-size: 10px; font-style: italic; color: #64748b; margin-bottom: 5px; font-weight: 600; }
        .motivation-author { font-size: 9px; font-weight: 800; color: #0f172a; background: #fbbf24; padding: 2px 8px; border-radius: 10px; display: inline-block; }

        .main-container { max-width: 800px; margin: 10px auto; padding: 0 15px; }
        .navigation-path-box { background: white; padding: 15px; border-radius: 15px; border-left: 5px solid #2563eb; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .folder-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; }
        .folder-card { background: #fff; padding: 20px 10px; border-radius: 15px; border: 1px solid #e2e8f0; text-align: center; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .folder-card:hover { transform: translateY(-3px); border-color: #fbbf24; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .folder-icon { width: 45px; height: 45px; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; }

        .test-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px; }
        .test-card { background: white; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; }

        footer { text-align: center; padding: 30px 20px; background: #fff; border-top: 1px solid #e2e8f0; margin-top: auto; }
        .footer-red-btn { background: #ef4444; color: #fff; font-size: 10px; font-weight: 800; padding: 4px 15px; border-radius: 20px; border: none; margin-bottom: 10px; cursor: pointer; text-transform: uppercase; }
        .copyright-text { font-size: 11px; color: #64748b; font-weight: 600; }

        #loading-screen { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-900"></div>
    </div>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="text-4xl">üë®‚Äçüéì</div>
            <h3 class="font-bold text-lg mt-2">Hello, <span id="sidebar-user-name">Student</span> üëã</h3>
            <p class="text-[10px] text-blue-200">Janz Education</p>
        </div>
        <ul class="sidebar-menu">
            <li onclick="window.location.href='dashboard.html'">üè† Home</li>
            <li>üë§ My Profile</li>
            <li id="sidebar-logout-btn" style="color: #ef4444;">üö™ Logout</li>
        </ul>
        <div class="motivation-box">
            <p class="motivation-text">"‡§Æ‡§Ç‡§ú‡§ø‡§≤ ‡§â‡§®‡•ç‡§π‡•Ä‡§Ç ‡§ï‡•ã ‡§Æ‡§ø‡§≤‡§§‡•Ä ‡§π‡•à, ‡§ú‡§ø‡§®‡§ï‡•á ‡§∏‡§™‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§® ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§"</p>
            <p class="motivation-author">~ MD AYUB JANZ</p>
        </div>
    </div>

    <div class='main-wrapper'>
        <header>
            <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
            <div class="header-text">
                <h1>JANZ EDUCATION</h1>
                <p>‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§™‡§®‡•ã‡§Ç ‡§ï‡•Ä ‡§â‡•ú‡§æ‡§® üöÄ</p>
            </div>
            <div style="width:26px;"></div>
        </header>

        <div class='main-container'>
            <div class="navigation-path-box">
                <div class="flex items-center gap-2">
                    <button id="back-btn" class="hidden text-blue-600 font-bold text-xs bg-blue-50 px-3 py-1.5 rounded-lg">‚¨ÖÔ∏è Back</button>
                    <p class="text-sm text-gray-500 font-medium" id="path-text">Test Series 2026</p>
                </div>
            </div>

            <h3 class="font-bold text-gray-700 mb-4 border-l-4 border-yellow-400 pl-3 uppercase text-xs" id="title-text">All Exams</h3>
            <div id="content-area" class="folder-grid"></div>
            <div id="no-data-msg" class="hidden text-center py-10"><p class="text-gray-400 text-sm">‡§Ö‡§≠‡•Ä ‡§Ø‡§π‡§æ‡§Å ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p></div>
        </div>
    </div>

    <footer>
        <button class="footer-red-btn">Help & Support</button>
        <p class="copyright-text">¬©2026 Janz Education ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ By Janz Group</p>
    </footer>

    <script type="module">
        import { auth, db } from "./config.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const loader = document.getElementById('loading-screen');
        const contentArea = document.getElementById('content-area');
        const pathText = document.getElementById('path-text');
        const titleText = document.getElementById('title-text');
        const backBtn = document.getElementById('back-btn');

        let allTests = [];
        let viewState = { level: 'exam', exam: '', subject: '' };
        const ADMIN_EMAIL = "mdayubjanz@gmail.com";

        // üëá Professional Subject Icon (SVG) üëá
        const subjectIconSVG = `<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-10 h-10"><path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 7H17" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 12H17" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 17H13" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;

        window.toggleSidebar = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('sidebar-overlay').classList.toggle('active');
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                if(user.email === ADMIN_EMAIL) { window.location.href = "admin.html"; return; }
                document.getElementById('sidebar-user-name').innerText = user.displayName || "Student";
                const testSnap = await getDocs(collection(db, "tests"));
                allTests = testSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                allTests.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
                history.replaceState({level: 'exam'}, "", "");
                renderUI();
                loader.style.display = 'none';
            } else {
                window.location.href = "index.html";
            }
        });

        function renderUI() {
            contentArea.innerHTML = "";
            if (viewState.level === 'exam') {
                contentArea.className = "folder-grid";
                pathText.innerText = "Test Series 2026";
                backBtn.classList.add('hidden');
                const exams = [...new Set(allTests.map(t => t.exam))];
                exams.forEach(ex => createFolder(ex, "üéì", () => {
                    viewState.level = 'subject'; viewState.exam = ex; 
                    history.pushState({level: 'subject'}, "", "#subject");
                    renderUI();
                }));
            } 
            else if (viewState.level === 'subject') {
                contentArea.className = "folder-grid";
                pathText.innerText = viewState.exam;
                backBtn.classList.remove('hidden');
                const subjects = [...new Set(allTests.filter(t => t.exam === viewState.exam).map(t => t.subject))];
                subjects.forEach(sub => createFolder(sub, subjectIconSVG, () => {
                    viewState.level = 'test'; viewState.subject = sub; 
                    history.pushState({level: 'test'}, "", "#test");
                    renderUI();
                }));
            }
            else if (viewState.level === 'test') {
                contentArea.className = "test-grid";
                pathText.innerText = viewState.subject;
                const tests = allTests.filter(t => t.exam === viewState.exam && t.subject === viewState.subject);
                tests.forEach(test => {
                    contentArea.innerHTML += `
                        <div class="test-card shadow-sm">
                            <h4 class="font-bold text-sm text-slate-800">${test.title}</h4>
                            <p class="text-[10px] text-gray-500 mt-1">üìù ${test.questions.length} Qs ‚Ä¢ ‚è≥ ${test.duration} min</p>
                            <button onclick="startTest('${test.id}')" class="w-full bg-blue-700 text-white mt-3 py-2 rounded-lg font-bold text-xs uppercase">Attempt Now</button>
                        </div>`;
                });
            }
        }

        function createFolder(name, icon, clickFn) {
            const div = document.createElement('div');
            div.className = "folder-card";
            div.innerHTML = `<div class="folder-icon">${icon}</div><span class="font-bold text-slate-700 text-[13px]">${name}</span>`;
            div.onclick = clickFn;
            contentArea.appendChild(div);
        }

        backBtn.onclick = () => { history.back(); };
        window.onpopstate = function(event) {
            if (viewState.level === 'test') { viewState.level = 'subject'; renderUI(); }
            else if (viewState.level === 'subject') { viewState.level = 'exam'; renderUI(); }
        };

        window.startTest = (id) => { window.location.href = `test-player.html?id=${id}`; };
        document.getElementById('sidebar-logout-btn').onclick = () => signOut(auth);
    </script>
</body>
</html>
